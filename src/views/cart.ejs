<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi ti·∫øt Gi·ªè h√†ng</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">

    <!-- Bootstrap -->
    <link type="text/css" rel="stylesheet" href="/css/bootstrap.min.css" />

    <!-- Slick -->
    <link type="text/css" rel="stylesheet" href="/css/slick.css" />
    <link type="text/css" rel="stylesheet" href="/css/slick-theme.css" />

    <!-- nouislider -->
    <link type="text/css" rel="stylesheet" href="/css/nouislider.min.css" />

    <!-- Font Awesome Icon -->
    <link rel="stylesheet" href="/css/font-awesome.min.css">

    <!-- Custom stlylesheet -->
    <link type="text/css" rel="stylesheet" href="/css/style.css" />
</head>

<body>
    <%- include('./header.ejs') %>
        <div class="container py-5">
            <div class="row">
                <div class="col-12">
                    <h1 class="section-title">Chi ti·∫øt gi·ªè h√†ng</h1>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-8">
                    <!-- Danh s√°ch s·∫£n ph·∫©m trong gi·ªè h√†ng -->
                    <div class="cart-items">
                        <!-- <div class="row align-items-center">
                            <div class="col-md-2">
                            </div>
                            <div class="col-md-4">
                            </div>
                            <div class="col-md-2">
                            </div>
                            <div class="col-md-3">
                                <div class="quantity-control">
                                    <div class="quantity-btn minus">-</div>
                                    <input type="text" class="quantity-input" value="1" min="1">
                                    <div class="quantity-btn plus">+</div>
                                </div>
                            </div>
                            <div class="col-md-1 text-end">
                                <i class="fas fa-trash remove-item"></i>
                            </div>
                        </div> -->
                    </div>

                    <div class="row mt-4 couponSection" id="couponSection">
                        <div class="col-md-6">
                            <div class="coupon-group" data-toggle="tooltips" title=" Th√™m m√£ gi·∫£m gi√°">
                                <input type="text" class="coupon-input" id="voucherCode" placeholder="M√£ gi·∫£m gi√°">
                                <button class="apply-btn" id="applyVoucherBtn" type="button">√Åp d·ª•ng</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4 mt-4 mt-lg-0">
                    <div class="cart-summary">
                        <h4 class="mb-4">Gi·ªè h√†ng</h4>

                        <div class="d-flex justify-content-between mb-2">
                            <span>T·∫°m t√≠nh</span>
                            <span id="subtotal">1,550,000‚Ç´</span>
                        </div>

                        <div class="d-flex justify-content-between mb-2">
                            <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
                            <span>Mi·ªÖn Ph√≠</span>
                        </div>

                        <div class="d-flex justify-content-between mb-2">
                            <span>Gi·∫£m gi√°</span>
                            <span id="discountAmount">0‚Ç´</span>

                        </div>

                        <hr>

                        <div class="d-flex justify-content-between mb-4">
                            <span class="fw-bold">T·ªïng c·ªông</span>
                            <span class="total-price" id="totalPrice">1,580,000‚Ç´</span>
                        </div>

                        <button id="checkoutButton" class="btn btn-primary checkout-btn ">Ti·∫øn h√†nh thanh to√°n</button>
                        <div class="mt-3 text-center">
                            <a href="/" class="continue-shopping-btn">
                                <i class="fas fa-arrow-left me-2"></i>Ti·∫øp t·ª•c mua s·∫Øm
                            </a>
                        </div>
                    </div>

                    <!-- <div class="mt-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title mb-3">Ph∆∞∆°ng th·ª©c thanh to√°n</h5>
                            <div class="d-flex gap-2 mb-2">
                                <img src="" alt="Visa" class="payment-icon">
                                <img src="/api/placeholder/40/25" alt="MasterCard" class="payment-icon">
                                <img src="/api/placeholder/40/25" alt="PayPal" class="payment-icon">
                                <img src="/images/momo.png" alt="Momo" class="payment-icon">
                            </div>
                        </div>
                    </div>
                </div> -->
                </div>
            </div>
        </div>
        <input type="hidden" id="isLoggedIn" value="<%= user ? 'true' : 'false' %>">
        <%- include('./footer.ejs') %>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
            <script src="/js/main.js"></script>
            <script src="/js/cart.js"></script>
            <script>
                document.getElementById('applyVoucherBtn').addEventListener('click', () => {
                    const code = document.getElementById('voucherCode').value.trim();
                    if (!code) return alert('Vui l√≤ng nh·∫≠p m√£ gi·∫£m gi√°');

                    fetch('/api/voucher/apply', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ code })
                    })
                        .then(res => res.json())
                        .then(data => {
                            if (!data.success) return alert(data.error || 'M√£ kh√¥ng h·ª£p l·ªá');

                            const voucher = data.voucher;
                            const discountPercent = voucher.voucher_value;

                            const cartSubtotal = getCartSubtotal(); // üëà l·∫•y t·ªïng ƒë∆°n h√†ng g·ªëc t·ª´ DOM
                            const discountAmount = Math.floor(cartSubtotal * discountPercent / 100);
                            const totalAfterDiscount = cartSubtotal - discountAmount;

                            document.querySelector('total-price').innerText = `T·ªïng c·ªông: ${totalAfterDiscount.toLocaleString('vi-VN')}ƒë`;
                        });
                });

                function getCartSubtotal() {
                    // V√≠ d·ª• l·∫•y t·ª´ th·∫ª ch·ª©a s·ªë ti·ªÅn g·ªëc
                    const subtotalText = document.querySelector('.cart-subtotal').innerText.replace(/[^\d]/g, '');
                    return parseInt(subtotalText) || 0;
                }
            </script>

</body>

</html>