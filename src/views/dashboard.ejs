<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- style -->
    <link rel="stylesheet" href="css/dashboardStyle.css">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar text-white p-3">
            <h4 class="text-center mb-4">Tech Admin</h4>
            <ul class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                <li class="nav-item">
                    <a class="nav-link active" id="v-dashboard-tab" data-bs-toggle="pill" data-bs-target="#dashboard"
                        type="button" role="tab">
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="v-orders-tab" data-bs-toggle="pill" data-bs-target="#orders" type="button"
                        role="tab">
                        <i class="fas fa-shopping-cart me-2"></i>Đơn hàng</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="v-products-tab" data-bs-toggle="pill" data-bs-target="#products"
                        type="button" role="tab">
                        <i class="fas fa-mobile-alt me-2"></i>Sản phẩm</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="v-categories-tab" data-bs-toggle="pill" data-bs-target="#categories"
                        type="button" role="tab">
                        <i class="fas fa-list me-2"></i>Loại sản phẩm</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="v-brands-tab" data-bs-toggle="pill" data-bs-target="#brands" type="button"
                        role="tab">
                        <i class="fas fa-tags me-2"></i>Nhãn hàng</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="v-shipping-tab" data-bs-toggle="pill" data-bs-target="#shipping"
                        type="button" role="tab">
                        <i class="fas fa-truck me-2"></i>Giao hàng</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="v-suppliers-tab" data-bs-toggle="pill" data-bs-target="#suppliers"
                        type="button" role="tab">
                        <i class="fas fa-warehouse me-2"></i>Nhà cung cấp</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" id="v-vouchers-tab" data-bs-toggle="pill" data-bs-target="#vouchers"
                        type="button" role="tab">
                        <i class="fas fa-ticket-alt me-2"></i>Mã giảm giá</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" id="v-accounts-tab" data-bs-toggle="pill" data-bs-target="#accounts"
                        type="button" role="tab"><i class="fas fa-users me-2"></i>Tài khoản</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white" href="/logout"><i class="fas fa-sign-out-alt me-2"></i> Đăng xuất</a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="tab-content" id="v-pills-tabContent">

            <!-- Stats Panels -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel" aria-labelledby="v-dashboard-tab">
                <h2>Dashboard</h2>
                <div class="row">
                    <div class="col-md-3">
                        <div class="dashboard-card revenue">
                            <div><i class="fas fa-dollar-sign"></i> Tổng doanh thu</div>
                            <div class="value">
                                <%= stats.total_revenue.toLocaleString('vi-VN') || 0%> VNĐ
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="dashboard-card orders">
                            <div><i class="fas fa-shopping-cart"></i> Đơn đặt hàng</div>
                            <div class="value">
                                <%= stats.total_orders || 0%>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="dashboard-card customers">
                            <div><i class="fas fa-users"></i> Khách hàng</div>
                            <div class="value">
                                <%= stats.total_customers || 0%>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="dashboard-card products">
                            <div><i class="fas fa-mobile-alt"></i> Sản phẩm hiện có</div>
                            <div class="value">
                                <%= stats.total_products || 0%>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- <div class="graphDisplay">
                    <div class="revenueGragh">
                        <canvas id="revenueChart" style="height: 370px; width: 100%;"></canvas>
                        <div class="yearCombobox">
                            <select id="yearSelect" class="form-control">
                                <% if (years && years.length> 0) { %>
                                    <% years.forEach(y=> { %>
                                        <option value="<%= y.year %>">
                                            <%= y.year %>
                                        </option>
                                        <% }) %>
                                            <% } else { %>
                                                <option disabled>Không có dữ liệu năm</option>
                                                <% } %>
                            </select>
                        </div>
                    </div>
                </div> -->

                <div class="graphDisplay">
                    <div class="row">
                        <div class="revenueGraph col-md-6" style="height:370px;">
                            <canvas id="revenueChart" style="height: 100%; width: 100%;"></canvas>
                        </div>
                        <div class="productGraph col-md-6" style="height:370px;">
                            <canvas id="productChart" style="height: 100%; width: 100%;"></canvas>
                        </div>
                    </div>

                    <div class="yearCombobox mt-3">
                        <div class="form-group">
                            <label for="yearSelect" class="form-label">Thống kê theo năm:</label>
                            <select id="yearSelect" class="form-control w-auto d-inline-block">
                                <% if (years && years.length> 0) { %>
                                    <% years.forEach(y=> { %>
                                        <option value="<%= y.year %>">
                                            <%= y.year %>
                                        </option>
                                        <% }) %>
                                            <% } else { %>
                                                <option disabled>Không có dữ liệu năm</option>
                                                <% } %>
                            </select>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Orders Section -->
            <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="v-orders-tab">
                <h3 class="section-title">Quản lý đơn hàng</h3>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Mã ĐH</th>
                                <th>Khách hàng</th>
                                <th>Ngày đặt</th>
                                <th>Phương thức</th>
                                <th>Tổng tiền</th>
                                <th>Trạng thái</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (orders.length> 0) { %>
                                <% orders.forEach(order=> { %>
                                    <tr>
                                        <td>#ORD<%= order.id %>
                                        </td>
                                        <td>
                                            <%= order.account_email || order.email || 'Không rõ' %>
                                        </td>
                                        <td>
                                            <%= new Date(order.created_at).toLocaleDateString('vi-VN') %>
                                        </td>
                                        <td>
                                            <%= order.payment_method %>
                                        </td>
                                        <td>
                                            <%= order.total_payment.toLocaleString('vi-VN') %> VNĐ
                                        </td>
                                        <td>
                                            <% if (order.order_status==='completed' ) { %>
                                                <span class="badge bg-success">
                                                    <%= order.order_status %>
                                                </span>
                                                <% } else if (order.order_status==='approving' ) { %>
                                                    <span class="badge bg-warning">
                                                        <%= order.order_status %>
                                                    </span>
                                                    <% } else if (order.order_status==='Đã hủy' ) { %>
                                                        <span class="badge bg-danger">
                                                            <%= order.order_status %>
                                                        </span>
                                                        <% } else { %>
                                                            <span class="badge bg-secondary">
                                                                <%= order.order_status %>
                                                            </span>
                                                            <% } %>
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal"
                                                data-bs-target="#orderDetailModal" data-id="<%= order.id %>"
                                                data-email="<%= order.account_email || order.email %>"
                                                data-name="<%= order.fullname || '' %>"
                                                data-phone="<%= order.phone || '' %>"
                                                data-date="<%= new Date(order.created_at).toLocaleDateString('vi-VN') %>"
                                                data-payment="<%= order.payment_method %>"
                                                data-total="<%= order.total_payment %>"
                                                data-address="<%= order.address || '' %>"
                                                data-note="<%= order.note || '' %>"
                                                data-status="<%= order.order_status %>">
                                                <i class="fas fa-eye"></i>
                                            </button>

                                            <form action="/order/<%= order.id %>" method="POST"
                                                class="d-inline order-delete-form" data-id="<%= order.id %>">
                                                <button type="submit" class="btn btn-sm btn-danger">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>

                                        </td>
                                    </tr>
                                    <% }) %>
                                        <% } else { %>
                                            <tr>
                                                <td colspan="7" class="text-center">Không có đơn hàng nào.</td>
                                            </tr>
                                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    document.querySelectorAll('.order-delete-form').forEach(form => {
                        form.addEventListener('submit', async (e) => {
                            e.preventDefault();
                            if (!confirm('Bạn có chắc muốn xóa đơn hàng này?')) return;

                            const orderId = form.getAttribute('data-id');
                            try {
                                const res = await fetch(`/api/order/${orderId}`, {
                                    method: 'DELETE',
                                    headers: { 'Content-Type': 'application/json' }
                                });


                                if (res.ok) {
                                    form.closest('tr').remove(); // Xóa dòng khỏi giao diện
                                } else {
                                    alert('Không thể xóa đơn hàng.');
                                }
                            } catch (err) {
                                alert('Đã xảy ra lỗi khi xóa đơn hàng.');
                                console.error(err);
                            }
                        });
                    });
                });
            </script>



            <!-- Modal Chi tiết đơn hàng -->
            <div class="modal fade" id="orderDetailModal" tabindex="-1" aria-labelledby="orderDetailModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <form id="orderUpdateForm">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Chi tiết đơn hàng</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Đóng"></button>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" name="_method" value="PUT">
                                <input type="hidden" name="order_status" value="Đã giao">
                                <input type="hidden" name="order_id" id="modalOrderId">

                                <p><strong>Họ tên:</strong> <span id="modalOrderName"></span></p>
                                <p><strong>Email:</strong> <span id="modalOrderEmail"></span></p>
                                <p><strong>Số điện thoại:</strong> <span id="modalOrderPhone"></span></p>
                                <p><strong>Ngày đặt:</strong> <span id="modalOrderDate"></span></p>
                                <p><strong>Phương thức thanh toán:</strong> <span id="modalOrderPayment"></span></p>
                                <p><strong>Địa chỉ:</strong> <span id="modalOrderAddress"></span></p>
                                <p><strong>Tổng tiền:</strong> <span id="modalOrderTotal"></span></p>
                                <p><strong>Ghi chú đơn hàng:</strong> <span id="modalOrderNote"></span></p>

                                <h6>Danh sách sản phẩm:</h6>
                                <ul id="modalOrderProducts" class="list-group mb-3">
                                    <li class="list-group-item text-muted">Đang tải...</li>
                                </ul>


                                <div class="mb-3">
                                    <label><strong>Trạng thái hiện tại:</strong></label><br>
                                    <span id="modalOrderStatusDisplay" class="badge bg-info">Đang xử lý</span>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" form="orderUpdateForm" class="btn btn-success">Duyệt đơn
                                    hàng</button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Script -->
            <script>
                function formatVND(value) {
                    return Number(value).toLocaleString('vi-VN') + ' VNĐ';
                }

                document.addEventListener('show.bs.modal', async function (event) {
                    const modal = event.target;
                    if (modal.id !== 'orderDetailModal') return;

                    const button = event.relatedTarget;
                    const id = button.getAttribute('data-id');

                    document.getElementById('orderUpdateForm').action = `/api/order-detail/${id}`;
                    document.getElementById('modalOrderId').value = id;
                    document.getElementById('modalOrderEmail').innerText = button.getAttribute('data-email') || '(Không có)';
                    document.getElementById('modalOrderName').innerText = button.getAttribute('data-name') || '(Không có)';
                    document.getElementById('modalOrderPhone').innerText = button.getAttribute('data-phone') || '(Không có)';
                    document.getElementById('modalOrderDate').innerText = button.getAttribute('data-date');
                    document.getElementById('modalOrderPayment').innerText = button.getAttribute('data-payment');
                    document.getElementById('modalOrderAddress').innerText = button.getAttribute('data-address') || '(Không có)';
                    document.getElementById('modalOrderTotal').innerText = formatVND(button.getAttribute('data-total') || 0);
                    document.getElementById('modalOrderNote').innerText = button.getAttribute('data-note') || '(Không có)';

                    const status = button.getAttribute('data-status');
                    const badge = document.getElementById('modalOrderStatusDisplay');
                    document.getElementById("orderUpdateForm").dataset.status = status;
                    badge.className = 'badge';
                    badge.classList.add(
                        status === 'Đã giao' ? 'bg-success' :
                            status === 'Đang chờ' ? 'bg-warning' :
                                status === 'Đã hủy' ? 'bg-danger' : 'bg-info'
                    );
                    badge.innerText = status;

                    const productList = document.getElementById('modalOrderProducts');
                    productList.innerHTML = `<li class="list-group-item text-muted">\u0110ang tải...</li>`;
                    try {
                        const res = await fetch(`/api/order-detail/${id}`);
                        const data = await res.json();
                        productList.innerHTML = '';
                        if (data.length === 0) {
                            productList.innerHTML = `<li class="list-group-item text-danger">Không có sản phẩm nào.</li>`;
                        } else {
                            data.forEach(item => {
                                const li = document.createElement('li');
                                li.className = 'list-group-item';
                                li.innerText = `${item.quantity}x ${item.product_name} - ${formatVND(item.subtotalprice)}`;
                                productList.appendChild(li);
                            });
                        }
                    } catch (err) {
                        productList.innerHTML = `<li class="list-group-item text-danger">Lỗi khi tải sản phẩm.</li>`;
                    }
                });

                document.getElementById("orderUpdateForm").addEventListener("submit", async function (e) {
                    e.preventDefault();

                    const orderId = document.getElementById("modalOrderId").value.trim();
                    const status = document.getElementById("orderUpdateForm").dataset.status; // Lấy từ dataset

                    if (!orderId || !status) {
                        alert("Thiếu thông tin đơn hàng.");
                        return;
                    }

                    if (status !== "approving") {
                        return;
                    }

                    try {
                        const response = await fetch(`/api/order/status/${orderId}`, {
                            method: "PUT",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({ status: "approving" })
                        });

                        if (response.ok) {
                            // alert("Đơn hàng đã chuyển sang trạng thái 'Đang giao hàng'.");
                            saveScrollAndTabAndReload();
                        } else {
                            const text = await response.text();
                            alert("Có lỗi xảy ra khi cập nhật đơn hàng: " + text);
                        }
                    } catch (error) {
                        alert("Lỗi khi gửi yêu cầu cập nhật đơn hàng.");
                        console.error(error);
                    }
                });
            </script>


            <!-- Products Section -->
            <div class="tab-pane fade" id="products" role="tabpanel" aria-labelledby="v-products-tab">
                <h3 class="section-title">Quản lý sản phẩm</h3>
                <div class="mb-3">
                    <!-- Nút mở popup -->
                    <a href="#" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addProductModal">
                        <i class="fas fa-plus"></i> Thêm sản phẩm mới
                    </a>

                    <!-- Modal Thêm Sản Phẩm -->
                    <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-xl modal-dialog-scrollable">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Thêm Sản Phẩm Mới</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Đóng"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="addProductForm" enctype="multipart/form-data">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label for="productCode" class="form-label">Mã sản phẩm</label>
                                                <input type="text" class="form-control" id="productCode"
                                                    name="productCode" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="productName" class="form-label">Tên sản phẩm</label>
                                                <input type="text" class="form-control" id="productName"
                                                    name="productName" required>
                                            </div>
                                            <div class="col-12">
                                                <label for="description" class="form-label">Mô tả</label>
                                                <textarea class="form-control" id="description" name="description"
                                                    rows="3"></textarea>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="importPrice" class="form-label">Giá nhập</label>
                                                <input type="number" class="form-control" id="importPrice"
                                                    name="importPrice" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="salePrice" class="form-label">Giá bán</label>
                                                <input type="number" class="form-control" id="salePrice"
                                                    name="salePrice" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="category" class="form-label">Loại sản phẩm</label>
                                                <select class="form-select" id="category" name="category">
                                                    <option value="">-- Chọn loại--</option>
                                                    <% categories.forEach(function(category) { %>
                                                        <option value="<%= category.id %>">
                                                            <%= category.name %>
                                                        </option>
                                                        <% }) %>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="brand" class="form-label">Hãng</label>
                                                <select class="form-select" id="brand" name="brand">
                                                    <option value="">-- Chọn hãng --</option>
                                                    <% brands.forEach(function(brand) { %>
                                                        <option value="<%= brand.brand_id %>">
                                                            <%= brand.brand_name %>
                                                        </option>
                                                        <% }) %>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="origin" class="form-label">Xuất xứ</label>
                                                <input type="text" class="form-control" id="origin" name="origin">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="warranty" class="form-label">Bảo hành (tháng)</label>
                                                <input type="number" class="form-control" id="warranty" name="warranty">
                                            </div>

                                            <!-- Hình ảnh -->
                                            <div class="col-md-12">
                                                <label for="images" class="form-label">Hình ảnh sản phẩm</label>
                                                <input class="form-control" type="file" id="images" name="images"
                                                    multiple accept="image/*">
                                                <div id="imagePreview" class="mt-2 d-flex flex-wrap gap-2"></div>
                                            </div>

                                            <!-- Thông số kỹ thuật -->
                                            <div class="col-md-12">
                                                <label for="specFile" class="form-label">Thông số kỹ thuật
                                                    (File)</label>
                                                <input class="form-control" type="file" id="specFile" name="specFile"
                                                    accept=".csv,.txt,.xlsx">
                                                <small class="text-muted">Hỗ trợ định dạng: CSV, TXT, Excel</small>

                                                <div id="specActions" class="mt-2" style="display: none;">
                                                    <button type="button" class="btn btn-sm btn-outline-danger"
                                                        onclick="clearSpecData_specFile()"> Xóa dữ liệu</button>
                                                </div>

                                                <div id="specTableContainer" class="mt-3" style="display: none;">
                                                    <h6>Thông số kỹ thuật:</h6>
                                                    <table class="table table-bordered table-sm">
                                                        <thead>
                                                            <tr>
                                                                <th>Thuộc tính</th>
                                                                <th>Giá trị</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="specTableBody"></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                    <button type="submit" form="addProductForm" class="btn btn-primary">Thêm sản
                                        phẩm</button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Modal chỉnh sửa sản phẩm -->
                    <div class="modal fade" id="updateProductModal" tabindex="-1"
                        aria-labelledby="updateProductModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-xl modal-dialog-scrollable">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Cập nhật sản phẩm</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Đóng"></button>
                                </div>

                                <div class="modal-body">
                                    <form id="updateProductForm" enctype="multipart/form-data">
                                        <input type="hidden" id="editProductId" name="id" />

                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label for="editProductCode" class="form-label">Mã sản phẩm</label>
                                                <input type="text" class="form-control" id="editProductCode"
                                                    name="productCode" required />
                                            </div>
                                            <div class="col-md-6">
                                                <label for="editProductName" class="form-label">Tên sản phẩm</label>
                                                <input type="text" class="form-control" id="editProductName"
                                                    name="productName" required />
                                            </div>

                                            <div class="col-12">
                                                <label for="editDescription" class="form-label">Mô tả</label>
                                                <textarea class="form-control" id="editDescription" name="description"
                                                    rows="3"></textarea>
                                            </div>

                                            <div class="col-md-6">
                                                <label for="editImportPrice" class="form-label">Giá nhập</label>
                                                <input type="number" class="form-control" id="editImportPrice"
                                                    name="importPrice" required />
                                            </div>
                                            <div class="col-md-6">
                                                <label for="editSalePrice" class="form-label">Giá bán</label>
                                                <input type="number" class="form-control" id="editSalePrice"
                                                    name="salePrice" required />
                                            </div>

                                            <div class="col-md-6">
                                                <label for="editCategory" class="form-label">Loại sản phẩm</label>
                                                <select class="form-select" id="editCategory" name="category">
                                                    <option value="">-- Chọn loại--</option>
                                                    <% categories.forEach(function(category) { %>
                                                        <option value="<%= category.id %>">
                                                            <%= category.name %>
                                                        </option>
                                                        <% }) %>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="editBrand" class="form-label">Hãng</label>
                                                <select class="form-select" id="editBrand" name="brand">
                                                    <option value="">-- Chọn nhãn hàng--</option>
                                                    <% brands.forEach(function(brand) { %>
                                                        <option value="<%= brand.brand_id %>">
                                                            <%= brand.brand_name %>
                                                        </option>
                                                        <% }) %>
                                                </select>
                                            </div>

                                            <div class="col-md-6">
                                                <label for="editOrigin" class="form-label">Xuất xứ</label>
                                                <input type="text" class="form-control" id="editOrigin" name="origin" />
                                            </div>
                                            <div class="col-md-6">
                                                <label for="editWarranty" class="form-label">Bảo hành
                                                    (tháng)</label>
                                                <input type="number" class="form-control" id="editWarranty"
                                                    name="warranty" />
                                            </div>

                                            <div class="col-md-12">
                                                <label for="editImages" class="form-label">Cập nhật hình ảnh</label>
                                                <input class="form-control" type="file" id="editImages" name="images"
                                                    multiple accept="image/*" />
                                                <div id="editImagePreview" class="mt-2 d-flex flex-wrap gap-2">

                                                </div>
                                            </div>

                                            <div class="col-md-12">
                                                <label for="editSpecFile" class="form-label">Thông số kỹ thuật
                                                    (File)</label>
                                                <input class="form-control" type="file" id="editSpecFile"
                                                    name="specFile" accept=".csv,.txt,.xlsx" />
                                                <small class="text-muted">Hỗ trợ định dạng: CSV, TXT, Excel</small>

                                                <div id="editSpecActions" class="mt-2" style="display: none;">
                                                    <button type="button" class="btn btn-sm btn-outline-danger"
                                                        onclick="clearSpecData_editSpecFile()">Xóa dữ liệu</button>
                                                </div>

                                                <div id="editSpecTableContainer" class="mt-3" style="display: none;">
                                                    <h6>Thông số kỹ thuật:</h6>
                                                    <table class="table table-bordered table-sm">
                                                        <thead>
                                                            <tr>
                                                                <th>Thuộc tính</th>
                                                                <th>Giá trị</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="editSpecTableBody"></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                    <button type="submit" form="updateProductForm" class="btn btn-primary">Cập
                                        nhật</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Thư viện SheetJS hỗ trợ đọc Excel -->
                    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
                    <!-- JavaScript xử lý ảnh và submit form -->


                </div>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Mã SP</th>
                                <th>Tên sản phẩm</th>
                                <th>Loại</th>
                                <th>Giá nhập</th>
                                <th>Giá bán</th>
                                <th>Xuất xứ</th>
                                <th>Bảo hành</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (products.length> 0) { %>
                                <% products.forEach((product)=> { %>
                                    <tr id="product-<%= product.id %>">
                                        <td>
                                            <%= product.fancy_id %>
                                        </td>
                                        <td>
                                            <%= product.name %>
                                        </td>
                                        <td>
                                            <%= product.category_name || 'Không rõ' %>
                                        </td>
                                        <td>
                                            <%= Number(product.import_price).toLocaleString('vi-VN') %> VNĐ
                                        </td>
                                        <td>
                                            <%= Number(product.retail_price).toLocaleString('vi-VN') %> VNĐ
                                        </td>
                                        <td>
                                            <%= product.origin %>
                                        </td>
                                        <td>
                                            <%= product.warranty %>
                                        </td>
                                        <td>
                                            <a href="/products/<%= product.id %>" class="btn btn-sm btn-primary"><i
                                                    class="fas fa-eye"></i></a>
                                            <!-- <a href="/products/<%= product.id %>/edit" class="btn btn-sm btn-info"><i class="fas fa-edit"></i></a> -->
                                            <!-- Button to trigger modal -->
                                            <a href="#" class="btn btn-sm btn-info editProductBtn"
                                                data-bs-toggle="modal" data-bs-target="#updateProductModal"
                                                data-id="<%= product.id %>" data-code="<%= product.fancy_id %>"
                                                data-name="<%= product.name %>"
                                                data-description="<%= product.description %>"
                                                data-importprice="<%= product.import_price %>"
                                                data-saleprice="<%= product.retail_price %>"
                                                data-category="<%= product.category_id %>"
                                                data-brand="<%= product.brand_id %>" data-origin="<%= product.origin %>"
                                                data-warranty="<%= product.warranty %>"
                                                data-images="<%= product.imageInserts %>"
                                                data-specs="<%= product.newDetail %>">
                                                <i class="fas fa-edit"></i>
                                            </a>

                                            <!-- Nút xóa -->
                                            <button class="btn btn-sm btn-danger delete-product-btn"
                                                data-id="<%= product.id %>">
                                                <i class="fas fa-trash"></i>
                                            </button>


                                        </td>

                                    </tr>

                                    <% }) %>
                                        <% } else { %>
                                            <tr>
                                                <td colspan="8" class="text-center">Không có sản phẩm nào.</td>
                                            </tr>
                                            <% } %>
                        </tbody>


                    </table>
                </div>

                <!-- <nav aria-label="Page navigation">
                <ul class="pagination justify-content-end">
                    <li class="page-item disabled"><a class="page-link" href="#">Trước</a></li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">Sau</a></li>
                </ul>
            </nav> -->
            </div>

            <!-- Categories Section -->
            <div class="tab-pane fade" id="categories" role="tabpanel" aria-labelledby="v-categories-tab">
                <h3 class="section-title">Quản lý loại sản phẩm</h3>
                <div class="mb-3">
                    <!-- Nút mở popup -->
                    <a href="#" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addCategoryModal">
                        <i class="fas fa-plus"></i> Thêm danh mục mới
                    </a>

                    <!-- Modal Thêm mới danh mục -->
                    <div class="modal fade" id="addCategoryModal" tabindex="-1" aria-labelledby="addCategoryModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="addCategoryModalLabel">Thêm loại sản phẩm</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Đóng"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="addCategoryForm">
                                        <div class="mb-3">
                                            <label for="categoryName" class="form-label">Tên loại sản phẩm</label>
                                            <input type="text" class="form-control" id="categoryName" name="cat_Name"
                                                placeholder="Nhập tên loại sản phẩm" required>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                    <button type="submit" form="addCategoryForm" class="btn btn-primary">Thêm</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Mã loại</th>
                                <th>Tên loại</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% categories.forEach((category)=> { %>
                                <tr>
                                    <td>
                                        <%= category.id %>
                                    </td>
                                    <td>
                                        <%= category.name %>
                                    </td>
                                    <td>
                                        <!-- Nút chỉnh sửa -->
                                        <a href="#" class="btn btn-sm btn-info editCategoryBtn" data-bs-toggle="modal"
                                            data-bs-target="#updateCategoryModal" data-id="<%= category.id %>"
                                            data-name="<%= category.name %>">
                                            <i class="fas fa-edit"></i>
                                        </a>


                                        <!-- Modal chỉnh sửa danh mục -->
                                        <div class="modal fade" id="updateCategoryModal" tabindex="-1"
                                            aria-labelledby="updateCategoryModalLabel" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="updateCategoryModalLabel">Cập
                                                            nhật danh
                                                            mục</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Đóng"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <form id="updateCategoryForm">
                                                            <input type="hidden" id="categoryId">
                                                            <div class="mb-3">
                                                                <label for="updateCategoryName" class="form-label">Tên
                                                                    danh
                                                                    mục</label>
                                                                <input type="text" class="form-control"
                                                                    id="updateCategoryName" name="name" required>
                                                            </div>
                                                        </form>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Hủy</button>
                                                        <button type="submit" form="updateCategoryForm"
                                                            class="btn btn-primary">Cập nhật</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                        <!-- Nút xóa danh mục -->
                                        <button class="btn btn-sm btn-danger delete-category-btn"
                                            data-id="<%= category.id %>">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                                <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Brands Section -->
            <div class="tab-pane fade" id="brands" role="tabpanel" aria-labelledby="v-brands-tab">
                <h3 class="section-title">Quản lý nhãn hàng</h3>
                <div class="mb-3">
                    <!-- Nút mở popup -->
                    <a href="#" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addBrandModal">
                        <i class="fas fa-plus"></i> Thêm nhãn hàng mới
                    </a>
                </div>

                <!-- Modal Thêm Nhãn Hàng -->
                <div class="modal fade" id="addBrandModal" tabindex="-1" aria-labelledby="addBrandModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addBrandModalLabel">Thêm nhãn hàng mới</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Đóng"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addBrandForm">
                                    <div class="mb-3">
                                        <label for="brandName" class="form-label">Tên nhãn hàng</label>
                                        <input type="text" class="form-control" id="brandName" name="brand_Name"
                                            placeholder="Nhập tên nhãn hàng" required>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                <button type="submit" form="addBrandForm" class="btn btn-primary">Thêm</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Mã nhãn hàng</th>
                                <th>Tên nhãn hàng</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (brands && brands.length> 0) { %>
                                <% brands.forEach((brand)=> { %>
                                    <tr>
                                        <td>
                                            <%= brand.brand_id %>
                                        </td>
                                        <td>
                                            <%= brand.brand_name %>
                                        </td>
                                        <td>
                                            <!-- Nút sửa -->
                                            <a href="#" class="btn btn-sm btn-info editBrandBtn" data-bs-toggle="modal"
                                                data-bs-target="#updateBrandModal" data-id="<%= brand.brand_id %>"
                                                data-name="<%= brand.brand_name %>">
                                                <i class="fas fa-edit"></i>
                                            </a>

                                            <!-- Modal Cập Nhật Nhãn Hàng -->
                                            <div class="modal fade" id="updateBrandModal" tabindex="-1"
                                                aria-labelledby="updateBrandModalLabel" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="updateBrandModalLabel">Cập nhật
                                                                nhãn hàng</h5>
                                                            <button type="button" class="btn-close"
                                                                data-bs-dismiss="modal" aria-label="Đóng"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <form id="updateBrandForm">
                                                                <input type="hidden" id="brandId">
                                                                <div class="mb-3">
                                                                    <label for="updateBrandName" class="form-label">Tên
                                                                        nhãn
                                                                        hàng</label>
                                                                    <input type="text" class="form-control"
                                                                        id="updateBrandName" name="brand_name" required>
                                                                </div>
                                                            </form>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">Hủy</button>
                                                            <button type="submit" form="updateBrandForm"
                                                                class="btn btn-primary">Cập nhật</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Nút xóa -->
                                            <button class="btn btn-sm btn-danger delete-brand-btn"
                                                data-id="<%= brand.brand_id %>">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <% }) %>
                                        <% } else { %>
                                            <tr>
                                                <td colspan="3" class="text-center">Không có nhãn hàng nào.</td>
                                            </tr>
                                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Shipping Section -->
            <div class="tab-pane fade" id="shipping" role="tabpanel" aria-labelledby="v-shipping-tab">
                <h3 class="section-title">Quản lý giao hàng</h3>
                <div class="mb-3">
                    <a href="#" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addShippingModal">
                        <i class="fas fa-plus"></i> Thêm đơn giao hàng
                    </a>

                </div>

                <!-- modal addShipping -->
                <div class="modal fade" id="addShippingModal" tabindex="-1" aria-labelledby="addShippingModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog modal-xl modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Thêm đơn giao hàng</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Đóng"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addProductForm" enctype="multipart/form-data">
                                    <div class="row g-3">
                                        <div class="col-md-12">
                                            <label for="productCode" class="form-label">Phương thức giao</label>
                                            <input type="text" class="form-control" id="productCode" name="productCode"
                                                required>
                                        </div>
                                        <div class="col-6">
                                            <a href="#" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addOrderModal">
                                                <i class="fas fa-plus"></i> Chọn đơn hàng
                                            </a>

                                        </div>

                                        <input type="hidden" name="_method" value="PUT">
                                        <input type="hidden" name="order_status" value="Đã giao">
                                        <input type="hidden" name="order_id" id="modalOrderId">

                                        <p><strong>Họ tên:</strong> <span id="modalOrderName"></span></p>
                                        <p><strong>Email:</strong> <span id="modalOrderEmail"></span></p>
                                        <p><strong>Số điện thoại:</strong> <span id="modalOrderPhone"></span></p>
                                        <p><strong>Ngày đặt:</strong> <span id="modalOrderDate"></span></p>
                                        <p><strong>Phương thức thanh toán:</strong> <span id="modalOrderPayment"></span>
                                        </p>
                                        <p><strong>Địa chỉ:</strong> <span id="modalOrderAddress"></span></p>
                                        <p><strong>Tổng tiền:</strong> <span id="modalOrderTotal"></span></p>
                                        <p><strong>Ghi chú đơn hàng:</strong> <span id="modalOrderNote"></span></p>

                                        <h6>Danh sách sản phẩm:</h6>
                                        <ul id="modalOrderProducts" class="list-group mb-3">
                                            <li class="list-group-item text-muted">Đang tải...</li>
                                        </ul>

                                    </div>
                                </form>
                            </div>



                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                <button type="submit" form="addProductForm" class="btn btn-primary">Thêm sản
                                    phẩm</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Mã giao hàng</th>
                                <th>Ngày giao</th>
                                <th>Phương thức giao</th>
                                <th>Trạng thái</th>
                                <th>Người nhận</th>
                                <th>Mã đơn hàng</th>
                                <th>Địa chỉ</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (shippings && shippings.length> 0) { %>
                                <% shippings.forEach(function(shipping) { %>
                                    <tr>
                                        <td>
                                            <%= shipping.id %>
                                        </td>
                                        <td>
                                            <%= shipping.shipping_date %>
                                        </td>
                                        <td>
                                            <%= shipping.delivery_method %>
                                        </td>
                                        <td>
                                            <%= shipping.shipping_status %>
                                        </td>
                                        <td>
                                            <%= shipping.customer_name || 'N/A' %>
                                        </td> <!-- nếu cần hiển thị tên thay vì id -->
                                        <td>
                                            <%= shipping.id_order %>
                                        </td>
                                        <td>
                                            <%= shipping.shipping_address %>
                                        </td>
                                        <td>
                                            <a href="/shippings/<%= shipping.id_shipping %>"
                                                class="btn btn-sm btn-info">
                                                <i class="fas fa-edit"></i>
                                            </a>

                                            <form action="/shippings/<%= shipping.id_shipping %>/delete" method="POST"
                                                style="display:inline;">
                                                <button class="btn btn-sm btn-danger"
                                                    onclick="return confirm('Bạn có chắc muốn xoá?')">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                    <% }) %>
                                        <% } else { %>
                                            <tr>
                                                <td colspan="8" class="text-center">Không có dữ liệu vận chuyển.
                                                </td>
                                            </tr>
                                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Supplier Section -->
            <div class="tab-pane fade" id="suppliers" role="tabpanel" aria-labelledby="v-suppliers-tab">
                <h3 class="section-title">Quản lý nhà cung cấp</h3>
                <div class="mb-3">
                    <!-- Nút mở popup -->
                    <a href="#" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addSupplierModal">
                        <i class="fas fa-plus"></i> Thêm nhà cung cấp mới
                    </a>
                </div>

                <!-- Modal Thêm Nhà Cung Cấp -->
                <div class="modal fade" id="addSupplierModal" tabindex="-1" aria-labelledby="addSupplierModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">

                            <div class="modal-header">
                                <h5 class="modal-title" id="addSupplierModalLabel">Thêm nhà cung cấp mới</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Đóng"></button>
                            </div>

                            <div class="modal-body">
                                <form id="addSupplierForm">
                                    <div class="mb-3">
                                        <label for="supplierName" class="form-label">Tên nhà cung cấp</label>
                                        <input type="text" class="form-control" id="supplierName" name="name"
                                            placeholder="Nhập tên nhà cung cấp" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="supplierPhonenumber" class="form-label">Số điện thoại</label>
                                        <input type="text" class="form-control" id="supplierPhonenumber"
                                            name="phonenumber" placeholder="Nhập số điện thoại" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="supplierEmail" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="supplierEmail" name="email"
                                            placeholder="Nhập email" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="supplierAddress" class="form-label">Địa chỉ</label>
                                        <input type="text" class="form-control" id="supplierAddress" name="address"
                                            placeholder="Nhập địa chỉ" required>
                                    </div>
                                </form>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                <button type="submit" form="addSupplierForm" class="btn btn-primary">Thêm</button>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Bảng nhà cung cấp -->
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Mã nhà cung cấp</th>
                                <th>Tên nhà cung cấp</th>
                                <th>Điện thoại</th>
                                <th>Email</th>
                                <th>Địa chỉ</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (suppliers && suppliers.length> 0) { %>
                                <% suppliers.forEach((supplier)=> { %>
                                    <tr>
                                        <td>
                                            <%= supplier.id %>
                                        </td>
                                        <td>
                                            <%= supplier.name %>
                                        </td>
                                        <td>
                                            <%= supplier.phonenumber %>
                                        </td>
                                        <td>
                                            <%= supplier.email %>
                                        </td>
                                        <td>
                                            <%= supplier.address %>
                                        </td>
                                        <td>
                                            <a href="#" class="btn btn-sm btn-info editSupplierBtn"
                                                data-bs-toggle="modal" data-bs-target="#updateSupplierModal"
                                                data-id="<%= supplier.id %>" data-name="<%= supplier.name %>"
                                                data-phonenumber="<%= supplier.phonenumber %>"
                                                data-email="<%= supplier.email %>"
                                                data-address="<%= supplier.address %>">
                                                <i class="fas fa-edit"></i>
                                            </a>

                                            <!-- Modal Cập Nhật Nhà Cung Cấp -->
                                            <div class="modal fade" id="updateSupplierModal" tabindex="-1"
                                                aria-labelledby="updateSupplierModalLabel" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered">
                                                    <div class="modal-content">

                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="updateSupplierModalLabel">
                                                                Cập nhật
                                                                nhà cung cấp</h5>
                                                            <button type="button" class="btn-close"
                                                                data-bs-dismiss="modal" aria-label="Đóng"></button>
                                                        </div>

                                                        <div class="modal-body">
                                                            <form id="updateSupplierForm">
                                                                <input type="hidden" id="updateSupplierId" name="id">
                                                                <div class="mb-3">
                                                                    <label for="updateSupplierName"
                                                                        class="form-label">Tên
                                                                        nhà cung cấp</label>
                                                                    <input type="text" class="form-control"
                                                                        id="updateSupplierName" name="name" required>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label for="updateSupplierPhonenumber"
                                                                        class="form-label">Số điện thoại</label>
                                                                    <input type="text" class="form-control"
                                                                        id="updateSupplierPhonenumber"
                                                                        name="phonenumber" required>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label for="updateSupplierEmail"
                                                                        class="form-label">Email</label>
                                                                    <input type="email" class="form-control"
                                                                        id="updateSupplierEmail" name="email" required>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label for="updateSupplierAddress"
                                                                        class="form-label">Địa chỉ</label>
                                                                    <input type="text" class="form-control"
                                                                        id="updateSupplierAddress" name="address"
                                                                        required>
                                                                </div>
                                                            </form>
                                                        </div>

                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">Hủy</button>
                                                            <button type="submit" form="updateSupplierForm"
                                                                class="btn btn-primary">Cập nhật</button>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>

                                            <button class="btn btn-sm btn-danger delete-supplier-btn"
                                                data-id="<%= supplier.id %>">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <% }) %>
                                        <% } else { %>
                                            <tr>
                                                <td colspan="6" class="text-center">Không có nhà cung cấp nào.</td>
                                            </tr>
                                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Voucher Section -->
            <div class="tab-pane fade" id="vouchers" role="tabpanel" aria-labelledby="v-vouchers-tab">
                <h3 class="section-title">Quản lý voucher</h3>
                <div class="mb-3">
                    <!-- Nút mở popup -->
                    <a href="#" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addVoucherModal">
                        <i class="fas fa-plus"></i> Thêm voucher mới
                    </a>

                    <!-- Modal Form -->
                    <div class="modal fade" id="addVoucherModal" tabindex="-1" aria-labelledby="addVoucherModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">

                                <div class="modal-header">
                                    <h5 class="modal-title" id="addVoucherModalLabel">Thêm Voucher</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Đóng"></button>
                                </div>

                                <div class="modal-body">
                                    <form id="addVoucherForm">
                                        <div class="mb-3">
                                            <label for="vouCode" class="form-label">Mã voucher</label>
                                            <input type="text" class="form-control" id="vouCode" name="vou_code"
                                                placeholder="Nhập mã voucher" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="vouValue" class="form-label">Giá trị (%)</label>
                                            <input type="number" class="form-control" id="vouValue" name="value"
                                                placeholder="Nhập giá trị voucher" min="1" max="100" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="startDate" class="form-label">Ngày bắt đầu</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="startDate" name="stardate"
                                                    placeholder="YYYY-MM-DD HH:mm:ss" required>
                                                <span class="input-group-text" id="startDateIcon"
                                                    style="cursor:pointer;">
                                                    <i class="fas fa-calendar-alt"></i>
                                                </span>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="endDate" class="form-label">Ngày kết thúc</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="endDate" name="enddate"
                                                    placeholder="YYYY-MM-DD HH:mm:ss" required>
                                                <span class="input-group-text" id="endDateIcon" style="cursor:pointer;">
                                                    <i class="fas fa-calendar-alt"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </form>
                                    <div id="voucherMessage" class="mt-2 text-danger" style="display:none;"></div>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                    <button type="submit" form="addVoucherForm" class="btn btn-primary">Thêm</button>
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- Modal Edit Form -->
                    <div class="modal fade" id="editVoucherModal" tabindex="-1" aria-labelledby="editVoucherModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">

                                <div class="modal-header">
                                    <h5 class="modal-title" id="editVoucherModalLabel">Chỉnh sửa Voucher</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Đóng"></button>
                                </div>

                                <div class="modal-body">
                                    <form id="editVoucherForm">
                                        <!-- Trường ẩn để chứa ID voucher -->
                                        <input type="hidden" id="editVoucherId" name="id">

                                        <div class="mb-3">
                                            <label for="editVouCode" class="form-label">Mã voucher</label>
                                            <input type="text" class="form-control" id="editVouCode" name="vou_code"
                                                placeholder="Nhập mã voucher" required>
                                        </div>

                                        <div class="mb-3">
                                            <label for="editVouValue" class="form-label">Giá trị (%)</label>
                                            <input type="number" class="form-control" id="editVouValue" name="value"
                                                placeholder="Nhập giá trị voucher" min="1" max="100" required>
                                        </div>

                                        <div class="mb-3">
                                            <label for="editStartDate" class="form-label">Ngày bắt đầu</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="editStartDate"
                                                    name="stardate" placeholder="YYYY-MM-DD HH:mm:ss" required>
                                                <span class="input-group-text" id="editStartDateIcon"
                                                    style="cursor:pointer;">
                                                    <i class="fas fa-calendar-alt"></i>
                                                </span>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="editEndDate" class="form-label">Ngày kết thúc</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="editEndDate" name="enddate"
                                                    placeholder="YYYY-MM-DD HH:mm:ss" required>
                                                <span class="input-group-text" id="editEndDateIcon"
                                                    style="cursor:pointer;">
                                                    <i class="fas fa-calendar-alt"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </form>
                                    <div id="editVoucherMessage" class="mt-2 text-danger" style="display:none;">
                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                    <button type="submit" form="editVoucherForm" class="btn btn-primary">Cập
                                        nhật</button>
                                </div>

                            </div>
                        </div>
                    </div>



                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Mã voucher</th>
                                    <th>Trị giá</th>
                                    <th>Ngày bắt đầu</th>
                                    <th>Ngày kết thúc</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if (vouchers && vouchers.length> 0) { %>
                                    <% vouchers.forEach((voucher, index)=> { %>
                                        <tr>
                                            <td>
                                                <%= voucher.id %>
                                            </td>
                                            <td>
                                                <%= voucher.voucher_code %>
                                            </td>
                                            <td>
                                                <%= voucher.voucher_value %>
                                            </td>
                                            <td>
                                                <%= voucher.date_start %>
                                            </td>
                                            <td>
                                                <%= voucher.date_end %>
                                            </td>
                                            <td>
                                                <button class="btn btn-sm btn-info edit-voucher-btn" title="Chỉnh sửa"
                                                    data-id="<%= voucher.id %>">
                                                    <i class="fas fa-edit"></i>
                                                </button>

                                                <button class="btn btn-sm btn-danger delete-voucher-btn" title="Xóa"
                                                    data-id="<%= voucher.id %>">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>

                                            </td>

                                        </tr>
                                        <% }) %>
                                            <% } else { %>
                                                <tr>
                                                    <td colspan="6" class="text-center">Không có voucher nào.</td>
                                                </tr>
                                                <% } %>
                            </tbody>

                        </table>
                    </div>
                </div>
            </div>

            <!-- Accounts Section -->
            <div class="tab-pane fade" id="accounts" role="tabpanel" aria-labelledby="v-vouchers-tab">
                <h3 class="section-title">Quản lý tài khoản</h3>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Email</th>
                                <th>Mật khẩu</th>
                                <th>Quyền</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% accounts.forEach((account, index)=> { %>
                                <tr>
                                    <td>
                                        <%= account.id %>
                                    </td>
                                    <td>
                                        <%= account.email %>
                                    </td>
                                    <td>
                                        <div class="input-group">
                                            <input type="password" class="form-control form-control-sm"
                                                value="<%= account.password %>" id="password<%= index %>" readonly>
                                            <button class="btn btn-sm btn-outline-secondary toggle-password"
                                                type="button" data-target="password<%= index %>">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </td>
                                    <td>
                                        <%= account.role %>
                                    </td>
                                    <td>
                                        <a href="/accounts/<%= account.id %>" class="btn btn-sm btn-primary"
                                            title="Xem chi tiết">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="/accounts/<%= account.id %>/edit" class="btn btn-sm btn-info"
                                            title="Chỉnh sửa">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <form action="/accounts/<%= account.id %>/delete" method="POST"
                                            class="d-inline">
                                            <button type="submit" class="btn btn-sm btn-danger"
                                                onclick="return confirm('Bạn có chắc muốn xoá tài khoản này?')"
                                                title="Xoá">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                <% }); %>
                        </tbody>

                    </table>
                </div>
            </div>
        </div>


        <!-- Bootstrap JS và jQuery -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Flatpickr JS -->
        <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
        <!-- JavaScript -->
        <script src="js/dashboardScript.js"></script>
        <script src="js/gragh.js"></script>

        <!-- Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <!-- <script>
            document.addEventListener("DOMContentLoaded", function () {
                const yearSelect = document.getElementById('yearSelect');

                fetch('/api/order/year')
                    .then(response => response.json())
                    .then(data => {
                        const years = data.Year;

                        if (!years || years.length === 0) {
                            yearSelect.innerHTML = `<option disabled>Không có dữ liệu năm</option>`;
                            return;
                        }

                        years.forEach(y => {
                            const option = document.createElement('option');
                            option.value = y.year;
                            option.textContent = y.year;
                            yearSelect.appendChild(option);
                        });


                        yearSelect.value = years[0].year;


                    })
                    .catch(error => {
                        console.error('Lỗi khi lấy danh sách năm:', error);
                    });
            });

            $(function () {
                let chart;

                function drawChart(data) {
                    const ctx = document.getElementById('revenueChart').getContext('2d');

                    data.sort((a, b) => a.month - b.month);

                    const labels = data.map(d => `Tháng ${d.month}`);
                    const values = data.map(d => d.total_payment_per_month);

                    const colors = [
                        "#3498db", "#e74c3c", "#f39c12", "#2ecc71", "#9b59b6", "#1abc9c",
                        "#e67e22", "#16a085", "#27ae60", "#2980b9", "#d35400", "#c0392b"
                    ];

                    const hoverColors = colors.map(color => lightenColor(color, 20));

                    if (chart) chart.destroy();

                    chart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Doanh thu theo tháng (VNĐ)',
                                data: values,
                                backgroundColor: colors,
                                hoverBackgroundColor: hoverColors
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Doanh thu theo tháng',
                                    font: {
                                        size: 22
                                    }
                                },
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function (context) {
                                            const value = context.parsed.y || 0;
                                            return 'Doanh thu: ' + value.toLocaleString('vi-VN') + ' VNĐ';
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    title: {
                                        display: true,
                                        text: 'Doanh thu (VNĐ)'
                                    },
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }

                function lightenColor(hex, percent) {
                    const num = parseInt(hex.replace("#", ""), 16);
                    const amt = Math.round(2.55 * percent);
                    const R = (num >> 16) + amt;
                    const G = ((num >> 8) & 0x00FF) + amt;
                    const B = (num & 0x0000FF) + amt;
                    return (
                        "#" +
                        (
                            0x1000000 +
                            (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +
                            (G < 255 ? (G < 1 ? 0 : G) : 255) * 0x100 +
                            (B < 255 ? (B < 1 ? 0 : B) : 255)
                        )
                            .toString(16)
                            .slice(1)
                    );
                }

                let year = document.querySelector('#yearSelect').value;
                $.getJSON(`/api/order/revenue/${year}`, function (response) {
                    console.log("Dữ liệu từ API:", response);
                    console.log("Kiểu:", typeof response.revenueByMonth);
                    if (response && response.revenueByMonth && Array.isArray(response.revenueByMonth)) {
                        drawChart(response.revenueByMonth);
                    } else {
                        console.warn("Không có dữ liệu hợp lệ để vẽ biểu đồ:", response);
                    }
                });
            });
        </script> -->




</body>

</html>